function ang=SteeringPhasesPA8(v,h,z,R,ElemLoc,f,c0)%   Function to calculate phases of each element of a PHASED ARRAY whose element locations%   are given by the ElemLoc matrix input. The transducer has a geometrical radius of curvature R.%   The focus is moved to a spot v,h,z (in cartesian coords) away from the center of curvature.%	v=vert shift, h=horiz shift, z is negative if toward transducer.  %   f=freq, c0=speed of sound in medium.% % Improvements:%   1/12/19 - %       Changed sign of h to account for the opposite direction of the x-axis in ERFA coordinates %       (RHS, the source of the original equations) and in HAS (LHS).%	Copyright D.A. Christensen 2019.%	Jan. 12, 2019 thvect=ElemLoc(:,1); phivect=ElemLoc(:,2); numelem=size(thvect,1); ang=zeros(numelem,1); for g=1:numelem          tt= R*sin(thvect(g)) ;    ss2=R*cos(thvect(g));    ss3=sin(phivect(g));    s=ss2.*ss3	;				    aa3=cos(phivect(g));    a=ss2.*aa3	;		    b=R-a;    d=R-(-z);    r=sqrt((tt-v).^2 + (s+h).^2 + (d-b).^2);	% matrix of distances to new focus. Note new                                                                    % sign in h.                                                                     kk=2*pi*f/c0;    ang(g)=kk*(r-R)	;					% a row vector phases in radians.  end